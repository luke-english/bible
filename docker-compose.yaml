version: "3.8"

services:
  alpine:
    build:
      context: alpine
      dockerfile: Dockerfile
    working_dir: /mnt/alpine
    volumes:
      - ./alpine:/mnt/alpine
      - ./src:/mnt/src
    entrypoint: "sh -c"
    command:
      - |
        # For educational purposes
        cat /usr/include/curses.h

        sh /mnt/alpine/build-alpine.sh
        /tmp/bible

  node:
    image: node
    working_dir: /mnt/node
    volumes:
      - ./node:/mnt/node:rw
    entrypoint: "bash -c"
    command:
      - |
        npm run build

  wasm:
    build:
      context: wasm
      dockerfile: Dockerfile
    working_dir: /mnt/wasm
    volumes:
      - ./wasm:/mnt/wasm:rw
      - ./src:/mnt/src
    entrypoint: "bash -c"
    command:
      - |
        /mnt/wasm/build-wasm.sh

  web:
    image: nginx
    volumes:
      - ./web/index.html:/usr/share/nginx/html/index.html
      - ./web/demo.html:/usr/share/nginx/html/demo.html
      - ./web/favicon.ico:/usr/share/nginx/html/favicon.ico
      - ./node:/usr/share/nginx/html/node
      - ./wasm:/usr/share/nginx/html/wasm
    ports:
      - 14001:80

